<!doctype html>
<html>

<head>
    <title>TecX: Dashboard</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.18.1/moment.min.js"></script>
    <script src="http://www.chartjs.org/dist/2.7.1/Chart.js"></script>
    <script src="http://www.chartjs.org/samples/latest/utils.js"></script>
    <link rel="stylesheet" href="style.css">
    <link rel="shortcut icon" href="img/logoTecx.png" type="image/x-icon">
    <link
        href="https://fonts.googleapis.com/css2?family=Open+Sans:ital,wght@0,300;0,400;0,600;0,700;0,800;1,300&family=Roboto:ital,wght@0,100;0,300;0,400;0,700;0,900;1,100;1,300;1,900&display=swap"
        rel="stylesheet">
    <!-- PUXAR O ESTILO DO GRÁFICO -->
    <style>
        canvas {
            -moz-user-select: none;
            -webkit-user-select: none;
            -ms-user-select: none;
        }
    </style>
</head>

<body>
    <input type="checkbox" id="check" style="display: none;">
    <!-- HEADER -->
    <div class="header">
        <div class="container">
            <div class="title-header">
                <img src="img/icons/user.svg" alt="">
                <p>Olá, empresa <span>X</span></p>
            </div>
            <div class="search">
                <input type="text" placeholder="Search">
                <img src="img/icons/search.svg" alt="">
            </div>
        </div>
    </div>
    <!-- FIM HEADER -->
    <!-- MENU FECHADO -->
    <div class="side-menu">
        <label class="option" for="check">
            <img src="img/icons/menu.svg" alt="">
        </label>
        <a onclick="changeToVehicles()">
            <div class="option">
                <img src="img/icons/truck.svg" alt="">
            </div>
        </a>
        <a onclick="changeToProfile()">
            <div class="option">
                <img src="img/icons/settings.svg" alt="">
            </div>
        </a>
        <div class="option">
            <img src="img/icons/log-out.svg" alt="">
        </div>
    </div>
    <!-- FIM MENU ABERTO -->
    <!-- MENU ABERTO -->
    <div class="side-menu_open">
        <nav>
            <label class="option" for="check">
                <img src="img/icons/menu.svg" alt="">
                <p>Menu</p>
            </label>
            <a onclick="changeToVehicles()">
                <div class="option">
                    <img src="img/icons/truck.svg" alt="">
                    <p>Veículos</p>
                </div>
            </a>
            <a onclick="changeToProfile()">
                <div class="option">
                    <img src="img/icons/settings.svg" alt="">
                    <p>Opções</p>
                </div>
            </a>
            <a onclick="">
                <div class="option">
                    <img src="img/icons/log-out.svg" alt="">
                    <p>Logout</p>
                </div>
            </a>
        </nav>
    </div>
    <!-- FIM MENU ABERTO -->
    <section class="section_main">
        <section class="section_container" id="home">
            <div class="charts">
                <div class="chart_div">
                    <div class="container">
                        <p><span>T</span>emperatura - <span>M</span>édia</p>
                        <section>
                            <div>
                                <img src="img/icons/thermometer.svg" alt="">
                                <label id='average'>
                                    0.00
                                </label>
                            </div>
                            <div>
                                <img src="img/icons/clock.svg" alt="">
                                <label id='averageHour'>
                                    0.00
                                </label>
                            </div>
                        </section>
                        <section style="width:80%; height: 80%;">
                            <canvas id="chart"></canvas>
                        </section>
                    </div>
                </div>
                <div class="chart_div">
                    <div class="container">
                        <p><span>U</span>midade - <span>M</span>édia</p>
                        <section>
                            <div>
                                <img src="img/icons/droplet.svg" alt="">
                                <label id='averageHumidity'>
                                    0.00
                                </label>
                            </div>
                            <div>
                                <img src="img/icons/clock.svg" alt="">
                                <label id='averageHourHumidity'>
                                    0.00
                                </label>
                            </div>
                        </section>
                        <section style="width:80%; height:80%;">
                            <canvas id="chart-humidity"></canvas>
                        </section>
                    </div>
                </div>
            </div>
            <div class="charts" id="home_2">
                <div class="chart_div">
                    <div class="container">
                        <img src="img/examples/simpleChart.png" alt="">
                    </div>
                </div>
                <div class="chart_div">
                    <div class="container">
                        <img src="img/examples/chartTemp.jpg" alt="">
                    </div>
                </div>
                <div class="chart_div">
                    <div class="container">
                        <img src="img/examples/simpleChart2.png" alt="">
                    </div>
                </div>
                <div class="chart_div">
                    <div class="container">
                        <img src="img/examples/chartTemp.jpg" alt="">
                    </div>
                </div>
            </div>
        </section>
        <!-- Uma div por semântica = section pegando toda a tela de monitoramento -->
        <section class="section_container" id="vehicles">
            <div class="buttons">
                <div class="buttons_div" style="background-color: #339FFF;;">
                    <div class="container" style="padding-top: 0;">
                        <p>Em Baixa</p>
                    </div>
                </div>
                <div class="buttons_div" style="background-color: #FBF00E">
                    <div class="container" style="padding-top: 0;">
                        <p>Em queda</p>
                    </div>
                </div>
                <div class="buttons_div" style="background-color: #27D72D;">
                    <div class="container" style="padding-top: 0;">
                        <p>Estável</p>
                    </div>
                </div>
                <div class="buttons_div" style="background-color: #FF6C00;">
                    <div class="container" style="padding-top: 0;">
                        <p>Em crescente</p>
                    </div>
                </div>
                <div class="buttons_div" style="background-color: #FF1616;">
                    <div class="container" style="padding-top: 0;">
                        <p>Em Alta</p>
                    </div>
                </div>
            </div>
            <div class="charts">
                <a onclick="changeToIndex()">
                    <div class="chart_div">
                        <div class="container">
                            <p><span>V</span>olvo <span>F</span>H - (DOB-4567) </p>
                            <img class="truck_img" src="img/vehicles/volvo-truck.png" alt="">
                            <div class="data-vehicle">
                                <img src="img/icons/thermometer.svg" alt="">
                                <label id='average2'>
                                    0.00
                                </label>
                            </div>
                            <div class="data-vehicle">
                                <img src="img/icons/droplet.svg" alt="">
                                <label id='averageHumidity2'>
                                    0.00
                                </label>
                            </div>
                        </div>
                    </div>
                </a>
                <div class="chart_div">
                    <div class="container">
                        <p><span>S</span>cannia <span>4</span>50 - (DRT-7789) </p>
                        <img class="truck_img" src="img/vehicles/scannia-truck.png" alt="">
                        <div class="data-vehicle">
                            <img src="img/icons/thermometer.svg" alt="">
                            <label id='average3'>
                                0.00
                            </label>
                        </div>
                        <div class="data-vehicle">
                            <img src="img/icons/droplet.svg" alt="">
                            <label id='averageHumidity3'>
                                0.00
                            </label>
                        </div>
                    </div>
                </div>
                <div class="chart_div">
                    <div class="container">
                        <p> <span>M</span>ercedes - (DRT-7789) </p>
                        <img class="truck_img" src="img/vehicles/mercedes_truck.png" alt="">
                        <div class="data-vehicle">
                            <img src="img/icons/thermometer.svg" alt="">
                            <label id='average4'>
                                0.00
                            </label>
                        </div>
                        <div class="data-vehicle">
                            <img src="img/icons/droplet.svg" alt="">
                            <label id='averageHumidity4'>
                                0.00
                            </label>
                        </div>
                    </div>
                </div>
                <div class="chart_div">
                    <div class="container">
                        <p><span>V</span>olkswagen - (RML-0987)</p>
                        <img class="truck_img" src="img/vehicles/volks_truck.png" alt="">
                        <div class="data-vehicle">
                            <img src="img/icons/thermometer.svg" alt="">
                            <label id='average5'>
                                0.00
                            </label>
                        </div>
                        <div class="data-vehicle">
                            <img src="img/icons/droplet.svg" alt="">
                            <label id='averageHumidity5'>
                                0.00
                            </label>
                        </div>
                    </div>
                </div>
            </div>
        </section>
        <!-- PÁGINA DE EDITAR PERFIL DAS EMPRESAS -->
        <section class="section_container" id="profile" style="display: none;">
            <div class="container">
                <img src="img/examples/pngwing.com.p" alt="">
            </div>
            <div class="container">
                <div class="align">
                    <p>Editar perfil</p>
                </div>
                <div class="align">
                    <input type="text" placeholder="Nome empresa">
                    <input type="text" placeholder="CNPJ">
                    <input type="text" class="ruaInput" placeholder="Rua">
                    <input type="text" class="numInput" placeholder="N°">
                    <input type="text" class="bairroInput" placeholder="Bairro">
                    <input type="text" class="cidadeInput" placeholder="Cidade">
                    <input type="text" class="cepInput" placeholder="CEP">
                </div>
                <div class="align_button">
                    <button>Salvar</button>
                </div>
            </div>
        </section>
        <!-- FIM PÁGINA DE EDITAR PERFIL EMPRESAS-->
        <script>
            /* FUNÇÕES DO JS PARA A TROCA DE TELAS */
            function changeToVehicles() {
                home.style = "display: none";
                vehicles.style = "display: block";
                profile.style = "display: none";
            }

            function changeToIndex() {
                home.style = "display: block";
                vehicles.style = "display: none";
                profile.style = "display: none";
            }

            function changeToProfile() {
                home.style = "display: none";
                vehicles.style = "display: none";
                profile.style = "display: block";
            }

            var config_chart_temp = {
                type: 'line',
                data: {
                    labels: [],
                    datasets: [{
                        label: 'Temperatura',
                        backgroundColor: window.chartColors.red,
                        borderColor: window.chartColors.red,
                        data: [],
                        fill: false,
                    }]
                },
                options: {
                    responsive: true,
                    title: {
                        display: true,

                    },
                    tooltips: {
                        mode: 'index',
                        intersect: false,
                    },
                    hover: {
                        mode: 'nearest',
                        intersect: true
                    },
                    scales: {
                        xAxes: [{
                            display: true,
                            scaleLabel: {
                                display: true,
                                labelString: 'Horário da Leitura'
                            }
                        }],
                        yAxes: [{
                            display: true,
                            scaleLabel: {
                                display: true,
                                labelString: 'ºC'
                            }
                        }]
                    }
                }
            };

            function get_temperatura() {
                var http = new XMLHttpRequest();
                http.open('GET', 'http://localhost:3000/api/', false);
                http.send(null);

                var obj = JSON.parse(http.responseText);
                document.getElementById('average').textContent = obj.average;
                document.getElementById('averageHour').textContent = obj.averageHour;

                document.getElementById('average2').textContent = obj.average;
                document.getElementById('average3').textContent = obj.average;
                document.getElementById('average4').textContent = obj.average;
                document.getElementById('average5').textContent = obj.average;


                if (obj.data.length == 0) {
                    return;
                }
                let test = 0;
                obj.data.forEach(el => {
                    test = el
                })
                return test;
            }
            this.lastIndexTemp = 0;
            this.time = 0;

            function get_humidade() {
                var http = new XMLHttpRequest();
                http.open('GET', 'http://localhost:3000/api/humidity', false);
                http.send(null);

                var obj = JSON.parse(http.responseText);
                document.getElementById('averageHumidity').textContent = obj.average;
                document.getElementById('averageHourHumidity').textContent = obj.averageHour;
                document.getElementById('averageHumidity2').textContent = obj.average;
                document.getElementById('averageHumidity3').textContent = obj.average;
                document.getElementById('averageHumidity4').textContent = obj.average;
                document.getElementById('averageHumidity5').textContent = obj.average;

                if (obj.data.length == 0) {
                    return;
                }
                let test = 0;
                obj.data.forEach(el => {
                    test = el
                })
                return test;
            }

            function receberNovasTemperaturas() {
                setTimeout(() => {
                    if (config_chart_temp.data.datasets[0].data.length >= 6) {
                        config_chart_temp.data.labels.shift();
                        config_chart_temp.data.datasets[0].data.shift();
                    }

                    if (config_chart_humi.data.datasets[0].data.length >= 6) {
                        config_chart_humi.data.labels.shift();
                        config_chart_humi.data.datasets[0].data.shift();
                    }

                    var agora = new Date();
                    var hora = agora.getHours();
                    var minuto = agora.getMinutes();
                    var segundo = agora.getSeconds();
                    var momento = `${hora > 9 ? '' : '0'}${hora}:${minuto > 9 ? '' : '0'}${minuto}:${segundo > 9 ? '' : '0'}${segundo}`;
                    // esse "novoRegistro" será recuperado do backend futuramente
                    var novoRegistro = {
                        momento: momento,
                        leitura: get_temperatura()
                    };

                    var novoRegistroHumi = {
                        momento: momento,
                        leitura: get_humidade()
                    }
                    // config_chart_temp.data.labels.shift(); // apagar o primeiro
                    config_chart_temp.data.labels.push(novoRegistro.momento); // incluir um novo momento
                    // config_chart_temp.data.datasets[0].data.shift();  // apagar o primeiro
                    config_chart_temp.data.datasets[0].data.push(novoRegistro.leitura); // incluir uma nova leitura

                    config_chart_humi.data.labels.push(novoRegistroHumi.momento);

                    config_chart_humi.data.datasets[0].data.push(novoRegistroHumi.leitura);

                    window.graficoLinha.update();
                    window.graficoHumidade.update();

                    receberNovasTemperaturas()
                }, 7000); // 7000 ms -> 7 segundos
            }

            //Gráfico umidade
            var config_chart_humi = {
                type: 'line',
                data: {
                    labels: [],
                    datasets: [{
                        label: 'Umidade',
                        backgroundColor: window.chartColors.blue,
                        borderColor: window.chartColors.blue,
                        data: [],
                        fill: false,
                    }]
                },
                options: {
                    responsive: true,

                    tooltips: {
                        mode: 'index',
                        intersect: false,
                    },
                    hover: {
                        mode: 'nearest',
                        intersect: true
                    },
                    scales: {
                        xAxes: [{
                            display: true,
                            scaleLabel: {
                                display: true,
                                labelString: 'Horário da Leitura'
                            }
                        }],
                        yAxes: [{
                            display: true,
                            scaleLabel: {
                                display: true,
                                labelString: '%'
                            }
                        }]
                    }
                }
            };

            function plotarGrafico() {
                var contexto_temperatura = document.getElementById('chart').getContext('2d');
                var contexto_humidade = document.getElementById('chart-humidity').getContext('2d');
                window.graficoLinha = new Chart(contexto_temperatura, config_chart_temp);
                window.graficoHumidade = new Chart(contexto_humidade, config_chart_humi);

                receberNovasTemperaturas();
            }
            window.onload = plotarGrafico;
        </script>
        <!-- FIM  FUNÇÕES DO JS PARA A TROCA DE TELAS-->
</body>

</html>